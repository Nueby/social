<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>找回密码</title>
		<link rel="stylesheet" href="../css/find_password.css" type="text/css" />
		<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
	</head>
	<body>
		<div id="Flowpath">
			<div id="path1">
				<div id="white_triangle1"></div>
				<i id="square">1.输入邮箱</i>
				<div id="black_triangle1">
				</div>
			</div>
			<div id="path2">
				<div id="white_triangle2"></div>
				<i id="square">2.邮箱验证</i>
				<div id="black_triangle2"></div>
			</div>
			<div id="path3">
				<div id="white_triangle3">	
				</div>
				<i id="square">3.重置密码</i>
				<div id="black_triangle3"></div>
			</div>
		</div>
		<div id="actionBox">
			<div id="Box1">
				<i id = "icon_email"></i>
				<input type="text" id="email" placeholder="请输入邮箱" />
				<button type="button" id="next1">下一步</button>
			</div>
			<div id="Box2">
				<input type="text" id="check_code" placeholder="请输入动态验证码" />
				<div id="code_right">
					<span id="get_code">获取动态验证码</span>
				</div>
				<button type="button" id="next2">下一步</button>
			</div>
			<div id="Box3">
				<i id = "icon_password_secret"></i>
				<input type="password" id="text" placeholder="请输入密码" />
				<i id = "icon_password_confirm"></i>
				<input type="password" id="change" placeholder="请确认密码" />
				<button type="button" id="last">完成</button>
			</div>
		</div>
		<script type="text/javascript">
			var box1 = document.getElementById("Box1");
			var box2 = document.getElementById("Box2");
			var box3 = document.getElementById("Box3");
			var next1 = document.getElementById("next1");
			var next2 = document.getElementById("next2");
			var last = document.getElementById("last");
			
			//下一步点击换内容,并且验证内容输入是否正确
			next1.onclick = function(){
				var email = document.getElementById("email");
				//var reg = /^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;
				if(email.value == ""){
					alert("请输入邮箱");
				//}else if(! reg.test(email)){
				//	box1.style.display = "none";
				//	box2.style.display = "block";
				}else{
				//	alert("请输入正确的邮箱地址");
				//	box1.style.display = "block";
				//	box2.style.display = "none";
					box1.style.display = "none";
					box2.style.display = "block";
				}
			}
			
			//获取验证码
			//Ajax发送邮箱验证码,检验验证码是否正确
			var get_code = document.getElementById("get_code");
			var countTime = 60;//时间为60秒
			var interval;
			var click = false;//验证是否点击
			function setTime() {
				if(countTime > 0){
					countTime--;
					get_code.innerHTML = countTime + "秒后重新发送";
				}else if(countTime == 0){
					countTime = 60;
					get_code.innerHTML = "获取验证码";
					clearInterval(interval);
					click = false;
				}
			}
			
			//获取验证码后改变字体
			get_code.onclick = function() {
				if(!click) {
					interval = setInterval("setTime()", 1000);
					click = true;
					var email = document.getElementById("email").value;
				    var json = {"behaviour":"getMsg","email":email};
				    $.ajax({
				     	type:"GET",
				     	url:"/SocialUtil/SendEmailController.do",
				     	data:{"json":JSON.stringify(json)},
				     	typeData:"json",
				     	success:function(data) {
				      		alert(data.status);
				     	},
				    	error:function(err) {
				     	 	alert(err.status);
				    	}
				    })
				}
			}
			
			
			
			
			//点击输入更换图标
			var icon_phone = document.getElementById("icon_phone");
			var icon_password_secret = document.getElementById("icon_password_secret");
			var icon_password_confirm = document.getElementById("icon_password_confirm");
			var text = document.getElementById("text");
			var change = document.getElementById("change");
			
			text.onclick = function(){
				icon_password_secret.setAttribute("id","icon_password_secret_2");
				icon_password_confirm.setAttribute("id","icon_password_confirm");
			}
			change.onclick = function(){
				icon_password_secret.setAttribute("id","icon_password_secret");
				icon_password_confirm.setAttribute("id","icon_password_confirm_2");
			}
			
			next2.onclick = function(){
				box2.style.display = "none";
				box3.style.display = "block";
				var input = document.getElementById("check_code").value;
			    var json = {"behaviour":"check","input":parseInt(input)};
			    $.ajax({
			     	type:"POST",
			    	 url:"/SocialUtil/SendEmailController.do",
			    	 data:JSON.stringify(json),
			    	 typeData:"json",
			    	 success:function(data) {
			    	 	alert(data.msg);
			   		 },
			   		 error:function(err) {
			      		alert(err.status);
			     	 }
			    })
			}
			last.onclick = function(){
				if(text.value != change.value){
					alert("您前后密码不一致，请重新输入");
					text.value = "";
					change.value = "";
				}else{
					alert("您的密码已重置，点击确定退出页面重新登录");
					window.location.href = "../matching.html";
				}
			}
		</script>
	</body>
</html>
